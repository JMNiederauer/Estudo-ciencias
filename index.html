<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pip-Pedro ‚Äî Trilha de Estudos (FIEL ao material)</title>
<style>
  :root{ --bg:#0a0f0a; --scan:#0f200f; --fg:#7CFFA5; --accent:#D5FFDF; --muted:#5dd98b; --panel:#0a140a; --border:#1c4a24; --screw:#223e28; }
  *{box-sizing:border-box}
  body{margin:0;background:radial-gradient(ellipse at center,var(--scan) 0%,#061006 70%) fixed;color:var(--fg);font-family:"Courier New",monospace}
  .pipwatch{position:relative;padding:12px;background:linear-gradient(180deg,#0c160c,#061006 60%);border-bottom:1px solid var(--border);overflow:hidden}
  .pipwatch-inner{display:flex;align-items:center;gap:16px;flex-wrap:wrap}
  .watch-bezel{width:160px;height:160px;min-width:160px;border-radius:20px;background:radial-gradient(circle at 50% 48%, #0d1a0f 0%, #0b160c 60%, #081208 100%);border:2px solid #15321d; position:relative; box-shadow:inset 0 0 22px #0007, 0 0 18px #0006}
  .watch-screen{position:absolute; inset:10px; border-radius:12px; background:#071107; border:1px solid #11311b; overflow:hidden}
  .scanlines::before{content:""; position:absolute; inset:0; background:repeating-linear-gradient(0deg, rgba(124,255,165,0.06), rgba(124,255,165,0.06) 1px, transparent 2px, transparent 5px); mix-blend-mode:screen; pointer-events:none; animation:scan 6s linear infinite}
  @keyframes scan{0%{transform:translateY(-10%)}50%{transform:translateY(10%)}100%{transform:translateY(-10%)}} 
  .watch-ui{position:absolute; inset:0; display:grid; grid-template-rows:1fr auto; padding:6px}
  .watch-hhmm{font-size:36px; letter-spacing:1px; text-align:center; margin-top:24px}
  .watch-date,.watch-sec{font-size:11px;color:var(--muted);text-align:center}
  .watch-bottom{display:flex; justify-content:space-between; align-items:center; font-size:11px; color:var(--muted);padding:0 6px 6px}
  .battery{width:60px;height:8px;border:1px solid var(--border);border-radius:4px; position:relative}
  .battery::after{content:""; position:absolute; right:-5px; top:1px; width:4px; height:6px; background:#11311b; border:1px solid var(--border); border-left:none; border-radius:0 2px 2px 0}
  .battery .fill{height:100%; width:70%; background:linear-gradient(90deg,#26ff8a,#6bffb0)}
  .screw{position:absolute;width:14px;height:14px;border-radius:50%;background:var(--screw);border:1px solid #152b1b;box-shadow:inset 0 0 4px #0008}
  .screw::after{content:""; position:absolute; left:3px; right:3px; top:6px; height:2px; background:#0a1a10}
  .s1{left:6px; top:6px} .s2{right:6px; top:6px} .s3{left:6px; bottom:6px} .s4{right:6px; bottom:6px}
  .titlebar h1{font-size:18px;margin:0;letter-spacing:1px}
  .titlebar .sub{font-size:12px;color:var(--muted)}
  .top-actions{margin-left:auto;display:flex;gap:8px}
  button{background:transparent;border:1px solid var(--border);color:var(--fg);padding:10px 12px;border-radius:10px;cursor:pointer;width:100%}
  button:hover{background:rgba(124,255,165,.12)}
  button[disabled]{opacity:.5;cursor:not-allowed}
  #wrap{max-width:980px;margin:12px auto;padding:10px;display:grid;grid-template-columns:1fr;gap:10px}
  .panel{border:1px solid var(--border);border-radius:12px;padding:12px;background:rgba(7,17,7,.5);box-shadow:inset 0 0 10px rgba(0,0,0,.5)}
  .title{font-weight:bold;margin-bottom:8px;text-transform:uppercase;font-size:12px;color:var(--accent)}
  .muted{color:var(--muted)}
  .grid{display:grid;gap:8px}
  .cols2{grid-template-columns:1fr 1fr}
  .log{max-height:220px;overflow:auto;border:1px dashed var(--border);padding:8px;border-radius:8px;background:rgba(0,0,0,.2);font-size:12px}
  #mapWrap{border:1px dashed var(--border);border-radius:10px;padding:10px;background:rgba(0,0,0,.2)}
  #map{display:flex;align-items:center;gap:8px;overflow:auto;padding-bottom:6px}
  .node{display:grid;justify-items:center;gap:6px;min-width:88px}
  .dot{width:26px;height:26px;border-radius:50%;border:2px solid var(--border);background:#0b150b;display:grid;place-items:center}
  .dot span{width:14px;height:14px;border-radius:50%;background:#184e2a}
  .node.done .dot span{background:#17d96a;box-shadow:0 0 10px #17d96a88}
  .node.curr .dot{border-color:#7cffb0}
  .node.curr .dot span{background:#7cffb0}
  .node label{font-size:11px;text-align:center}
  .arrow{width:40px;min-width:40px;height:2px;background:linear-gradient(90deg,#214a2a,#357d47);position:relative}
  .arrow::after{content:""; position:absolute; right:-2px; top:-4px; border:6px solid transparent; border-left-color:#357d47}
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:99}
  .card{width:min(720px,92vw);background:#081108;border:1px solid var(--border);border-radius:12px;padding:14px}
  .small{font-size:12px}
  .summary{border:1px dashed var(--border);padding:10px;border-radius:10px;background:rgba(0,0,0,.15);font-size:13px;line-height:1.35}
  .choice{width:100%;text-align:left}
  @media (min-width:640px){#wrap{grid-template-columns:320px 1fr}}
</style>
</head>
<body>
  <div class="pipwatch">
    <div class="pipwatch-inner">
      <div class="watch-bezel">
        <div class="screw s1"></div><div class="screw s2"></div><div class="screw s3"></div><div class="screw s4"></div>
        <div class="watch-screen scanlines">
          <div class="watch-ui">
            <div>
              <div id="watch-hhmm" class="watch-hhmm">--:--</div>
              <div id="watch-date" class="watch-date">---</div>
              <div id="watch-sec" class="watch-sec">-- s</div>
            </div>
            <div class="watch-bottom">
              <div>MODE: ESTUDO</div>
              <div class="battery"><div id="batFill" class="fill"></div></div>
              <div>Trilha</div>
            </div>
          </div>
        </div>
      </div>
      <div class="titlebar">
        <div>
          <h1>üìü Pip-Pedro ‚Äî C√©lulas & Tecidos (Fiel ao PDF)</h1>
          <div class="sub">Estudo guiado + quiz com o texto da apresenta√ß√£o</div>
        </div>
      </div>
      <div class="top-actions">
        <button id="btnReset">Zerar progresso</button>
      </div>
    </div>
  </div>

  <div id="wrap">
    <section class="panel">
      <div class="title">Objetivo</div>
      <div id="objective" class="small"></div>

      <div class="title" style="margin-top:12px">Mapa da Trilha</div>
      <div id="mapWrap">
        <div id="map">
          <div class="node" id="n-org"><div class="dot"><span></span></div><label>Organiza√ß√£o</label></div>
          <div class="arrow"></div>
          <div class="node" id="n-tipos"><div class="dot"><span></span></div><label>Tipos de C√©lula</label></div>
          <div class="arrow"></div>
          <div class="node" id="n-memb"><div class="dot"><span></span></div><label>Membrana</label></div>
          <div class="arrow"></div>
          <div class="node" id="n-organelas"><div class="dot"><span></span></div><label>Organelas</label></div>
          <div class="arrow"></div>
          <div class="node" id="n-tec"><div class="dot"><span></span></div><label>Tecidos</label></div>
          <div class="arrow"></div>
          <div class="node" id="n-pele"><div class="dot"><span></span></div><label>Pele/Epit√©lio</label></div>
          <div class="arrow"></div>
          <div class="node" id="n-micro"><div class="dot"><span></span></div><label>Microscopia</label></div>
        </div>
      </div>

      <div class="title" style="margin-top:12px">Registro</div>
      <div id="log" class="log"></div>
    </section>

    <section class="panel">
      <div class="title">Local</div>
      <div id="locName"><b>Abrigo ‚Äî In√≠cio</b></div>
      <div class="muted small" id="locDesc">Estude a se√ß√£o e depois fa√ßa 2 de 3 no quiz.</div>

      <div class="title" style="margin-top:10px">A√ß√µes</div>
      <div id="choices" class="grid"></div>
    </section>
  </div>

  <div class="modal" id="quizModal" role="dialog" aria-modal="true">
    <div class="card">
      <div id="modalTitle" class="title"></div>
      <div id="sectionSummary" class="summary" style="display:none"></div>
      <div id="qContext" class="small muted" style="margin-top:6px"></div>
      <div id="qText" style="margin:6px 0 8px"></div>
      <div id="qAns" class="grid cols2"></div>
      <div id="qFeedback" class="small" style="margin-top:8px"></div>
      <div class="small muted" id="qCounter"></div>
      <div style="margin-top:10px;display:flex;gap:8px;justify-content:flex-end">
        <button id="qClose">Fechar</button>
      </div>
    </div>
  </div>

<script>
function clickSfx(){ try{ const ctx=new (window.AudioContext||window.webkitAudioContext)(); const o=ctx.createOscillator(), g=ctx.createGain(); o.type='square'; o.frequency.value=800; g.gain.value=.08; o.connect(g).connect(ctx.destination); o.start(); g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.06); o.stop(ctx.currentTime + 0.06);}catch{} }

/* ===== RESUMOS ‚Äî somente frases do PDF (par√°frase m√≠nima) ===== */
const SUMMARIES = {
  org: `‚Ä¢ ‚ÄúTODO SER VIVO √â FORMADO POR C√âLULA‚Äù. C√©lulas com estruturas e fun√ß√µes semelhantes se agrupam formando <b>tecidos</b>. A uni√£o de diferentes tecidos forma <b>√≥rg√£os</b>; √≥rg√£os que trabalham para uma fun√ß√£o formam <b>sistemas</b>; o conjunto dos sistemas comp√µe o <b>organismo</b>.`,
  tipos: `‚Ä¢ <b>Procariontes</b>: encontradas em bact√©rias e arqueias; t√™m membrana plasm√°tica; <b>n√£o possuem n√∫cleo</b> nem outras organelas membranosas; DNA disperso no citoplasma; possuem <b>parede celular</b> e <b>ribossomos</b>. ‚Ä¢ <b>Eucariontes</b>: podem ser animais (sem parede celular) ou vegetais (com parede).`,
  memb: `‚Ä¢ <b>Membrana plasm√°tica</b>, presente em <b>todas as c√©lulas</b>, contorna a c√©lula e √© por onde ocorre a <b>entrada e a sa√≠da</b> de subst√¢ncias.`,
  organelas: `‚Ä¢ <b>RER</b>: produ√ß√£o de prote√≠nas. ‚Ä¢ <b>REL</b>: transporte/produ√ß√£o de lip√≠dios. ‚Ä¢ <b>Mitoc√¥ndrias</b>: gerar energia para a c√©lula. ‚Ä¢ <b>Complexo golgiense</b>: secretar prote√≠nas para transporte. ‚Ä¢ <b>Lisossomos</b>: digest√£o intracelular. ‚Ä¢ <b>Centr√≠olos</b>: forma√ß√£o de c√≠lios e flagelos. ‚Ä¢ Em vegetais: <b>vac√∫olos</b> (armazenam, sobretudo √°gua), <b>cloroplastos</b> (fotoss√≠ntese), <b>parede celular celul√≥sica</b> (protege o conte√∫do).`,
  tec: `‚Ä¢ Tecidos s√£o conjuntos celulares que desempenham determinada fun√ß√£o. Nos animais: <b>epitelial, conjuntivo, muscular, nervoso</b>. O <b>epitelial</b> reveste superf√≠cies externas (pele) e cavidades internas; uni√£o forte entre c√©lulas ‚Üí barreira contra invasores e perda de l√≠quidos.`,
  pele: `‚Ä¢ <b>Pele</b> tem tr√™s camadas: <b>epiderme</b> (evita desidrata√ß√£o e entrada de invasores; cont√©m melan√≥citos que produzem melanina), <b>derme</b> (resist√™ncia/elasticidade; fol√≠culos, gl√¢ndulas, vasos, nervos apoiados no col√°geno), <b>hipoderme</b> (camada final; conserva calor e absorve choques, camada de gordura). O <b>conjuntivo</b> realiza conex√£o, sustenta√ß√£o, defesa, preenchimento, transporte e reserva; √© vascularizado (exceto cartilagem), tem <b>matriz extracelular</b> e o <b>sangue</b> transporta gases, excretas, nutrientes e produtos celulares.`,
  micro: `‚Ä¢ <b>Robert Hooke</b>: microsc√≥pio composto (duas lentes); observou corti√ßa (tecido vegetal morto) e descreveu ‚Äúc√©lulas‚Äù ao ver os compartimentos. ‚Ä¢ Microsc√≥pios modernos: <b>√≥ptico</b> e <b>eletr√¥nico</b>.`
};

/* ===== QUEST√ïES ‚Äî constru√≠das s√≥ com o que est√° no PDF ===== */
const QUESTIONS = {
  org: [
    {context:"Texto do slide: ‚ÄúTODO SER VIVO √â FORMADO POR C√âLULA‚Äù.", 
     q:"O conjunto de c√©lulas com estruturas e fun√ß√µes semelhantes recebe o nome de:", 
     a:["√≥rg√£o","tecido","organismo","sistema"], ok:1}, // ÓàÄfilecite turn1file0 L33-L41
    {context:"Sequ√™ncia descrita nos slides de n√≠veis de organiza√ß√£o.", 
     q:"Complete: c√©lulas ‚Üí tecidos ‚Üí √≥rg√£os ‚Üí sistemas ‚Üí ____", 
     a:["organismo","biosfera","√°tomo","mol√©cula"], ok:0}, // ÓàÄfilecite turn1file1 L48-L56
    {context:"Conceito geral do cap√≠tulo.", 
     q:"Quem √© a unidade b√°sica dos seres vivos?", 
     a:["tecido","√≥rg√£o","c√©lula","sistema"], ok:2} // inferido do enunciado "todo ser vivo √© formado por c√©lula"
  ],
  tipos: [
    {context:"Teste do slide ‚ÄúTE TESTANDO‚Äù.", 
     q:"Organismos procariontes se destacam pela:", 
     a:["aus√™ncia de membrana plasm√°tica","aus√™ncia de citoplasma","aus√™ncia de n√∫cleo delimitado por membrana","aus√™ncia de material gen√©tico"], ok:2}, // ÓàÄfilecite turn1file3 L52-L59
    {context:"Animal √ó Vegetal.", 
     q:"Nas c√©lulas eucari√≥ticas, assinale a compara√ß√£o correta:", 
     a:["animal tem parede celular; vegetal n√£o tem","vegetal tem parede celular; animal n√£o tem","nenhuma tem parede celular","ambas t√™m parede celular"], ok:1}, // ÓàÄfilecite turn1file3 L67-L69
    {context:"Procariontes ‚Äî estruturas citadas.", 
     q:"Quais estruturas s√£o listadas para procariontes?", 
     a:["carioteca e cloroplastos","membrana, parede celular e ribossomos","vac√∫olos e lisossomos","centrossomos e REL"], ok:1} // ÓàÄfilecite turn1file0 L97-L108
  ],
  memb: [
    {context:"Defini√ß√£o literal do slide.", 
     q:"A membrana plasm√°tica est√° presente em:", 
     a:["apenas c√©lulas animais","todas as c√©lulas","apenas c√©lulas vegetais","apenas procariontes"], ok:1}, // ÓàÄfilecite turn1file3 L15-L18
    {context:"Fun√ß√£o descrita no slide.", 
     q:"Ela contorna a c√©lula e √© por onde ocorre:", 
     a:["a forma√ß√£o do DNA","a entrada e a sa√≠da de subst√¢ncias","apenas a entrada de √°gua","a produ√ß√£o de ATP"], ok:1}, // ÓàÄfilecite turn1file3 L18-L22
    {context:"Refor√ßo da defini√ß√£o.", 
     q:"Qual alternativa est√° de acordo com o slide sobre membrana plasm√°tica?", 
     a:["√© exclusiva de animais","√© onde ocorre entrada e sa√≠da de subst√¢ncias","substitui a parede celular","armazena o material gen√©tico"], ok:1} // ÓàÄfilecite turn1file3 L18-L22
  ],
  organelas: [
    {context:"Lista de organelas e fun√ß√µes (animal).", 
     q:"O ret√≠culo endoplasm√°tico rugoso (RER) tem como fun√ß√£o:", 
     a:["produ√ß√£o de prote√≠nas","produ√ß√£o de ATP","digest√£o intracelular","forma√ß√£o de c√≠lios"], ok:0}, // ÓàÄfilecite turn1file1 L1-L3
    {context:"Lista de organelas e fun√ß√µes (animal).", 
     q:"O complexo golgiense √© respons√°vel por:", 
     a:["secretar prote√≠nas para transporte","armazenar √°gua","produzir DNA","fotoss√≠ntese"], ok:0}, // ÓàÄfilecite turn1file1 L5-L6
    {context:"Lista de organelas e fun√ß√µes (animal).", 
     q:"Qual alternativa corresponde √† fun√ß√£o da mitoc√¥ndria?", 
     a:["gerar energia para a c√©lula","formar parede celular","armazenar pigmentos","conduzir impulsos"], ok:0}, // ÓàÄfilecite turn1file1 L4-L4
    {context:"Lista de organelas e fun√ß√µes (animal).", 
     q:"Lisossomos realizam principalmente:", 
     a:["digest√£o intracelular","fotoss√≠ntese","s√≠ntese de lip√≠dios","transporte ativo"], ok:0}, // ÓàÄfilecite turn1file1 L8-L8
    {context:"Lista de organelas e fun√ß√µes (animal).", 
     q:"Centr√≠olos participam da forma√ß√£o de:", 
     a:["c√≠lios e flagelos","cloroplastos","vac√∫olos","ribossomos"], ok:0}, // ÓàÄfilecite turn1file1 L9-L10
    {context:"Lista vegetal.", 
     q:"Nos vegetais, vac√∫olos t√™m fun√ß√£o principal de:", 
     a:["armazenamento (principalmente √°gua)","gera√ß√£o de ATP","condu√ß√£o de impulsos","contra√ß√£o"], ok:0}, // ÓàÄfilecite turn1file1 L23-L25
    {context:"Lista vegetal.", 
     q:"Cloroplastos:", 
     a:["produzem alimento por fotoss√≠ntese","digest√£o intracelular","armazenam √°gua","formam c√≠lios"], ok:0}, // ÓàÄfilecite turn1file1 L26-L27
    {context:"Lista vegetal.", 
     q:"A parede celular celul√≥sica:", 
     a:["protege o conte√∫do celular","delimita o n√∫cleo","produz prote√≠nas","√© exclusiva de animais"], ok:0} // ÓàÄfilecite turn1file1 L29-L29
  ],
  tec: [
    {context:"Defini√ß√£o nos slides.", 
     q:"Tecidos s√£o:", 
     a:["c√©lulas isoladas sem fun√ß√£o","conjuntos celulares que desempenham determinada fun√ß√£o","apenas √≥rg√£os de revestimento","estruturas sem especializa√ß√£o"], ok:1}, // ÓàÄfilecite turn1file2 L35-L38
    {context:"Quatro grupos citados.", 
     q:"Nos animais, os quatro grandes grupos de tecidos incluem:", 
     a:["epitelial, conjuntivo, muscular e nervoso","epid√©rmico, √≥sseo, adiposo e nervoso","xilema, floema, col√™nquima e par√™nquima","meristemas e par√™nquimas"], ok:0}, // ÓàÄfilecite turn1file1 L100-L103
    {context:"Epitelial ‚Äî fun√ß√£o e local.", 
     q:"O tecido epitelial tem fun√ß√£o de:", 
     a:["revestimento de superf√≠cies externas e cavidades internas","armazenamento de √°gua","contra√ß√£o","condu√ß√£o el√©trica"], ok:0} // ÓàÄfilecite turn1file2 L54-L59
  ],
  pele: [
    {context:"Camadas da pele.", 
     q:"A pele √© constitu√≠da por:", 
     a:["epiderme, derme e hipoderme","derme, hipoderme e endoderme","epiderme e hipoderme apenas","derme e epidermis (duas camadas)"], ok:0}, // ÓàÄfilecite turn1file2 L74-L77
    {context:"Fun√ß√£o da epiderme.", 
     q:"Segundo o slide, a epiderme:", 
     a:["evita desidrata√ß√£o e entrada de invasores","√© a camada de gordura","√© respons√°vel pela fotoss√≠ntese","produz ATP"], ok:0}, // ÓàÄfilecite turn1file2 L78-L86
    {context:"Derme.", 
     q:"A derme √© respons√°vel por:", 
     a:["resist√™ncia e elasticidade; fol√≠culos, gl√¢ndulas, vasos e nervos no col√°geno","barreira contra desidrata√ß√£o","reserva energ√©tica","produ√ß√£o de melanina"], ok:0}, // ÓàÄfilecite turn1file2 L94-L106
    {context:"Hipoderme.", 
     q:"A hipoderme:", 
     a:["conserva calor e absorve choques (camada de gordura)","√© a camada externa","conduz impulsos nervosos","√© o local da fotoss√≠ntese"], ok:0} // ÓàÄfilecite turn1file2 L112-L119
  ],
  micro: [
    {context:"Descoberta da c√©lula.", 
     q:"Robert Hooke utilizou um microsc√≥pio:", 
     a:["composto (duas lentes)","eletr√¥nico","sem lente","de raios X"], ok:0}, // ÓàÄfilecite turn1file0 L47-L55
    {context:"Corti√ßa no slide.", 
     q:"Em corti√ßa, Hooke observou principalmente:", 
     a:["os espa√ßos/compartimentos (as ‚Äòc√©lulas‚Äô)","mitoc√¥ndrias vivas","DNA","cloroplastos"], ok:0}, // ÓàÄfilecite turn1file0 L50-L55
    {context:"Tipos modernos.", 
     q:"Quais microsc√≥pios modernos aparecem no slide?", 
     a:["√≥ptico e eletr√¥nico","ultravioleta e gama","√≥ptico apenas","eletr√¥nico apenas"], ok:0} // ÓàÄfilecite turn1file0 L59-L63
  ]
};

/* ===== TRILHA ===== */
const SECTIONS = [
  {key:'org', label:'Organiza√ß√£o dos seres vivos'},
  {key:'tipos', label:'Tipos de c√©lula'},
  {key:'memb', label:'Membrana plasm√°tica'},
  {key:'organelas', label:'Organelas'},
  {key:'tec', label:'Tecidos'},
  {key:'pele', label:'Pele & Epit√©lio'},
  {key:'micro', label:'Microscopia'}
];

const state = { passed:{org:false,tipos:false,memb:false,organelas:false,tec:false,pele:false,micro:false}, loc:'start' };

const objective=document.getElementById('objective');
const locName=document.getElementById('locName');
const locDesc=document.getElementById('locDesc');
const choices=document.getElementById('choices');
const logEl=document.getElementById('log');
const btnReset=document.getElementById('btnReset');

function log(t){ logEl.innerHTML += `‚Ä¢ ${t}<br>`; logEl.scrollTop = logEl.scrollHeight; }
function currentStep(){ for(let i=0;i<SECTIONS.length;i++){ if(!state.passed[SECTIONS[i].key]) return i; } return SECTIONS.length; }
function renderObjective(){ const i=currentStep(); objective.textContent = i<SECTIONS.length ? `Estude a se√ß√£o: ${SECTIONS[i].label} e acerte 2/3 no quiz.` : "Trilha conclu√≠da. Clique em ‚ÄúConcluir estudo‚Äù."; }
function save(){ try{ localStorage.setItem("pipPedroStudyV1", JSON.stringify(state)); }catch{} }
function load(){ try{ const s=JSON.parse(localStorage.getItem("pipPedroStudyV1")||"null"); if(s) Object.assign(state,s); }catch{} }

function renderMap(){
  const domIds = ['n-org','n-tipos','n-memb','n-organelas','n-tec','n-pele','n-micro'];
  domIds.forEach((id,i)=>{
    const el=document.getElementById(id);
    el.className='node';
    if(state.passed[SECTIONS[i].key]) el.classList.add('done');
    if(i===currentStep()) el.classList.add('curr');
  });
}

function gotoStart(){
  state.loc='start'; save();
  locName.innerHTML='<b>Abrigo ‚Äî In√≠cio</b>';
  locDesc.textContent='Estude cada √°rea e depois fa√ßa o quiz (2/3).';
  choices.innerHTML='';
  const i=currentStep();
  if(i<SECTIONS.length){
    addChoice(`Estudar: ${SECTIONS[i].label}`, ()=>openSummary(SECTIONS[i].key));
    addChoice(`Quiz (2 de 3): ${SECTIONS[i].label}`, ()=>startQuiz(SECTIONS[i].key));
  } else {
    addChoice('Concluir estudo', ()=>{ log('<b>Parab√©ns! Trilha conclu√≠da.</b>'); });
  }
  renderObjective(); renderMap();
}
function addChoice(label,fn){ const b=document.createElement('button'); b.className='choice'; b.textContent=label; b.onclick=()=>{ clickSfx(); fn(); }; choices.appendChild(b); }

const quizModal=document.getElementById('quizModal');
const modalTitle=document.getElementById('modalTitle');
const sectionSummary=document.getElementById('sectionSummary');
const qContext=document.getElementById('qContext');
const qText=document.getElementById('qText');
const qAns=document.getElementById('qAns');
const qFeedback=document.getElementById('qFeedback');
const qCounter=document.getElementById('qCounter');
document.getElementById('qClose').onclick=()=>{ quizModal.style.display='none'; };

function openSummary(key){
  modalTitle.textContent = 'Resumo ‚Äî ' + sectionLabel(key);
  sectionSummary.style.display='block';
  sectionSummary.innerHTML = SUMMARIES[key];
  qContext.textContent=''; qText.textContent=''; qAns.innerHTML=''; qFeedback.textContent=''; qCounter.textContent='';
  quizModal.style.display='flex';
}

/* ===== QUIZ (meta din√¢mica + t√©rmino imediato + prote√ß√£o contra duplo clique) ===== */
function startQuiz(key){
  const pool = QUESTIONS[key].slice();
  shuffle(pool);

  const picks = pool.slice(0, Math.min(3, pool.length)); // at√© 3
  const target = Math.min(2, picks.length);              // meta 2, ou 1 se s√≥ houver 1 pergunta
  if (picks.length === 0){ state.passed[key]=true; save(); log(`Se√ß√£o conclu√≠da: <b>${sectionLabel(key)}</b>.`); gotoStart(); return; }

  let idx = 0, correct = 0;

  modalTitle.textContent = 'Quiz ‚Äî ' + sectionLabel(key);
  sectionSummary.style.display='none';

  function updateCounter(){ qCounter.textContent = `Acertos: ${correct} / ${idx}  (precisa de ${target})`; }

  function ask(){
    if (correct >= target){ return finish(); }
    if (idx >= picks.length){
      if (correct >= target) return finish();
      qFeedback.innerHTML = `<span class='muted'>Voc√™ fez ${correct}/${picks.length}. Tente novamente.</span>`;
      setTimeout(()=>{ quizModal.style.display='none'; }, 700);
      return;
    }
    const item = picks[idx];
    qContext.textContent = item.context;
    qText.textContent = 'Pergunta: ' + item.q;
    qAns.innerHTML = ''; qFeedback.textContent = ''; updateCounter();

    item.a.forEach((opt, i)=>{
      const b = document.createElement('button'); 
      b.textContent = opt;
      b.onclick = ()=>{
        clickSfx();
        qAns.querySelectorAll('button').forEach(x=>x.disabled=true); // evita duplo clique
        if (Number(i) === Number(item.ok)){ correct++; qFeedback.innerHTML = "<b>‚úî Correto!</b>"; }
        else { qFeedback.innerHTML = "<b>‚úñ Resposta incorreta.</b>"; }
        const done = (correct >= target);
        idx++;
        if (done){ setTimeout(finish, 350); return; }
        if (idx >= picks.length){ setTimeout(()=>{ (correct >= target) ? finish() : (quizModal.style.display='none'); }, 350); return; }
        setTimeout(ask, 350);
      };
      qAns.appendChild(b);
    });
  }

  function finish(){
    state.passed[key] = true; save();
    log(`Se√ß√£o conclu√≠da: <b>${sectionLabel(key)}</b>.`);
    quizModal.style.display='none';
    gotoStart();
  }

  quizModal.style.display='flex';
  ask();
}

/* ===== utils ===== */
function sectionLabel(k){ return (SECTIONS.find(s=>s.key===k)||{}).label||''; }
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }

/* ===== Rel√≥gio ===== */
function pad(n){return (n<10?'0':'')+n;}
function updateWatch(){
  const now = new Date();
  const hh = pad(now.getHours()), mm = pad(now.getMinutes()), ss = pad(now.getSeconds());
  const days = ["Dom","Seg","Ter","Qua","Qui","Sex","S√°b"];
  const months = ["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];
  document.getElementById('watch-hhmm').textContent = `${hh}:${mm}`;
  document.getElementById('watch-sec').textContent = `${ss} s`;
  document.getElementById('watch-date').textContent = `${days[now.getDay()]} ‚Ä¢ ${pad(now.getDate())} ${months[now.getMonth()]} ${now.getFullYear()}`;
  const bat = 50 + 40*Math.sin(now.getMinutes()/60*Math.PI*2);
  document.getElementById('batFill').style.width = `${Math.max(8,Math.min(98,bat))}%`;
}
setInterval(updateWatch, 1000); updateWatch();

/* ===== Inicializa√ß√£o ===== */
btnReset.onclick = ()=>{ if(confirm("Apagar progresso salvo?")){ localStorage.removeItem("pipPedroStudyV1"); location.reload(); } };
load(); gotoStart(); renderMap();
log("Bem-vindo, Pedro. Estude cada √°rea e fa√ßa os quizzes.");
</script>
</body>
</html>
